<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Feed configuration. -->
    <link href="https://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Patrick Cloke Atom Feed" />
    <link href="https://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Patrick Cloke RSS Feed" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="/theme/css/styles.css">
    <link rel="stylesheet" href="/theme/css/borland.css">
    <link rel="stylesheet" href="/theme/css/youtube.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <title>Compiling Instantbird</title>

    <meta property="og:site_name" content="Patrick Cloke" />
<meta property="og:title" content="Compiling Instantbird" />
<meta property="og:url" content="https://patrick.cloke.us/posts/2011/05/16/compilling-instantbird/" />
<meta property="og:description" content="In the past I’ve tried to compile a few different programs that use the Mozilla toolkit to various levels of success. I’ve tried to compile Thunderbird, Songbird and Instantbird at various points. I got Thunderbird to compile, but it only worked sporadically (although I think that was Firefox …" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-05-16T21:30:00-04:00" />
<meta property="article:author" content="Patrick Cloke" />
<meta property="article:tag" content="Instantbird" />
<meta property="article:tag" content="Mozilla" />
<meta property="article:tag" content="programming" />

    <script async defer data-domain="cloke.us" src="https://plausible.io/js/plausible.js"></script>
  </head>

  <body class="pb-5">
    <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light border-bottom border-info">
      <a class="navbar-brand" href="/">
        Patrick Cloke
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-items" aria-controls="navbar-items" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <span class="collapse navbar-collapse" id="navbar-items">
        <ul class="navbar-nav ml-auto">

          <li class="nav-item">
            <a class="nav-link" href="/pages/about.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/pages/projects.html">Projects</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/archives.html">Archives</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tags.html">Tags</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="social-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Social
            </a>

            <span class="dropdown-menu dropdown-menu-right" aria-labelledby="social-dropdown">
              <a class="dropdown-item" href="https://mastodon.social/@clokep" target="_blank">
                  <span class="fab fa-mastodon mr-1"></span>
                mastodon
              </a>
              <a class="dropdown-item" href="https://www.twitter.com/clokep" target="_blank">
                  <span class="fab fa-twitter mr-1"></span>
                twitter
              </a>
              <a class="dropdown-item" href="https://matrix.to/#/@clokep:matrix.org" target="_blank">
                  <span class="pl-3 mr-2"></span>
                matrix
              </a>
              <a class="dropdown-item" href="https://github.com/clokep" target="_blank">
                  <span class="fab fa-github mr-1"></span>
                github
              </a>
              <a class="dropdown-item" href="https://gitlab.com/clokep" target="_blank">
                  <span class="fab fa-gitlab mr-1"></span>
                gitlab
              </a>
              <a class="dropdown-item" href="https://www.linkedin.com/in/patrickcloke/" target="_blank">
                  <span class="fab fa-linkedin mr-1"></span>
                linkedin
              </a>
            </span>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="feeds-dropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Feeds
            </a>

            <span class="dropdown-menu dropdown-menu-right" aria-labelledby="feeds-dropdown">
              <a class="dropdown-item" href="https://patrick.cloke.us/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a>
              <a class="dropdown-item" href="https://patrick.cloke.us/feeds/rss.xml" type="application/rss+xml" rel="alternate">rss feed</a>
            </span>
          </li>

          <form class="form-inline" method="get" action="http://www.google.com/search">
            <input class="form-control form-control-sm mr-sm-2" type="search" name="q" placeholder="Search" aria-label="Search" />
            <input type="hidden"  name="sitesearch" value="patrick.cloke.us" />

            <button class="btn btn-sm btn-outline-info d-none d-sm-inline" type="submit">Search</button>
          </form>
        </ul>
      </div>
    </nav>

<div class="container">
  <div class="row">
    <div class="col-md-12 mt-2 mb-2">
      <h1>
        <a href="/posts/2011/05/16/compilling-instantbird/" rel="bookmark"
           title="Permalink to Compiling Instantbird">Compiling&nbsp;Instantbird</a>
      </h1>

      <div class="row">
        <div class="col-sm">
          <span class="text-secondary font-weight-light font-italic">Published on Monday, May 16, 2011</span>

          <br>
          <span class="text-secondary font-weight-light font-italic">
            Tags:               <a href="/tag/instantbird.html">Instantbird</a>,              <a href="/tag/mozilla.html">Mozilla</a>,              <a href="/tag/programming.html">programming</a>          </span>
        </div>

        <div class="col-sm text-right">
          <a href="https://twitter.com/intent/tweet?text=Compiling%C2%A0Instantbird&url=https%3A//patrick.cloke.us/posts/2011/05/16/compilling-instantbird/&hashtags=instantbird,mozilla,programming" target="_blank" class="ml-1 mr-1" title="Share on Twitter">
            <span class="fab fa-twitter"></span>
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//patrick.cloke.us/posts/2011/05/16/compilling-instantbird/" target="_blank" class="ml-1 mr-1" title="Share on Facebook">
            <span class="fab fa-facebook"></span>
          </a>
          <a href="mailto:?subject=Compiling%C2%A0Instantbird&amp;body=https%3A//patrick.cloke.us/posts/2011/05/16/compilling-instantbird/" target="_blank" class="ml-1 mr-1" title="Share via Email">
            <span class="fas fa-envelope"></span>
          </a>
        </div>
      </div>

      <hr>

      <div>
        <div class="border border-info bg-light rounded float-right p-2 ml-2 mb-2">
          <div class="toc" id="">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#build-requirements" id="id2">Build Requirements:</a><ul>
<li><a class="reference internal" href="#visual-studio-express" id="id3">Visual Studio Express:</a></li>
<li><a class="reference internal" href="#microsoft-windows-sdk" id="id4">Microsoft Windows <span class="caps">SDK</span>:</a></li>
<li><a class="reference internal" href="#microsoft-macro-assembler" id="id5">Microsoft Macro Assembler:</a></li>
<li><a class="reference internal" href="#mozillabuild" id="id6">MozillaBuild:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#checkout-the-code" id="id7">Checkout the Code:</a></li>
<li><a class="reference internal" href="#id1" id="id8">Compiling Instantbird:</a></li>
</ul>
</div>
        </div>

        
<p>In the past I’ve tried to compile a few different programs that use
the Mozilla toolkit to various levels of success. I’ve tried to compile
Thunderbird, Songbird and Instantbird at various points. I got
Thunderbird to compile, but it only worked sporadically (although I
think that was Firefox moving so fast that Thunderbird couldn’t keep
up), Songbird I gave up on rather quickly and Instantbird I’ve tried a
few times.</p>
<p>Last summer I had Instantbird compiling on my old laptop (a Lenovo
T60), which is &gt;5 years old at this point and has had the heatsink / fan
replaced twice — a known issue with that model laptop. Needless to
say, that laptop didn’t like compiling something on Windows that took
approximately an hour with a large number of reads and writes to the
hard drive. This mixed with it being an old dual core + a 5400 <span class="caps">RPM</span>
meant I’d be waiting a <span class="caps">LONG</span> time for my code to compile. I got a
Thinkpad X201 this past summer, so I finally got around to setting up a
development environment on it and was able to get Instantbird to compile
fully today. I’ve outlined the steps I’ve followed: kind of to mirror
the <a class="reference external" href="https://developer.mozilla.org/En/Simple_Thunderbird_build">Simple Thunderbird Build</a> page on <span class="caps">MDC</span>.</p>
<p>I’ve done this using Microsoft Windows 7 Professional (64-bit) with
Service Pack 1. (4.00 <span class="caps">GB</span> of <span class="caps">RAM</span>, Intel Core i7 M620 2.67 GHz).
Throughout these steps, the defaults locations and options are used in
the installers.</p>
<div class="section" id="build-requirements">
<h2><a class="toc-backref" href="#id2">Build Requirements:</a></h2>
<div class="section" id="visual-studio-express">
<h3><a class="toc-backref" href="#id3">Visual Studio Express:</a></h3>
<p>We need to install Visual Studio Express, specifically <span class="caps">VC8</span> (2005) with
Service Pack 1. (Mozilla compiles with <span class="caps">VC9</span> and <span class="caps">VC10</span> to various degrees,
but it seems libpurple only compiles with <span class="caps">VC8</span>, also this is what’s on
the Instantbird buildbot, so I like having the same version.) I
couldn’t find this on Microsoft’s website but I found it on <a class="reference external" href="http://www.softpedia.com/get/Programming/Other-Programming-Files/Microsoft-Visual-C-Toolkit.shtml">Softpedia</a>
(which is a legitimate site). Anyway, download the installer and
install it (which will download the actual compiler from Microsoft),
ensure that you also install the <span class="caps">IDE</span> (which is checked by default).</p>
<p>This will only install <span class="caps">VC8</span>, the initial release. We also need to
install <a class="reference external" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=7b0b0339-613a-46e6-ab4d-080d4d4a8c4e">Service Pack 1</a>. I personally did this using Windows Update,
but one of the installers from there should also work.</p>
</div>
<div class="section" id="microsoft-windows-sdk">
<h3><a class="toc-backref" href="#id4">Microsoft Windows <span class="caps">SDK</span>:</a></h3>
<p>Specifically we need the <a class="reference external" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=c17ba869-9671-4330-a63e-1fd44e0e2505&amp;displaylang=en">Windows 7 <span class="caps">SDK</span></a> (for Jumplist, Aero, etc.
support). Download and install the <span class="caps">SDK</span>, this one took a while for me to
install. I ate dinner while it was installing (pasta, if you’re curious
— I already had sauce made).</p>
<p>There’s a linker error when using <span class="caps">VC8</span> and the Windows 7 <span class="caps">SDK</span>, so we’ll
need to install a <a class="reference external" href="http://support.microsoft.com/kb/949009/">hotfix</a> for that (I tried without it and I ran into
the issue). I had to download the “VS80sp1-<span class="caps">KB949009</span>-<span class="caps">IA64</span>-<span class="caps">INTL</span>.exe”
version (there’s also an X86 and an X64 version). Choose the one that works.</p>
</div>
<div class="section" id="microsoft-macro-assembler">
<h3><a class="toc-backref" href="#id5">Microsoft Macro Assembler:</a></h3>
<p>In order to properly assemble the code we need to <a class="reference external" href="http://www.microsoft.com/downloads/en/details.aspx?familyid=7A1C9DA0-0510-44A2-B042-7EF370530C64&amp;displaylang=en">install <span class="caps">MASM</span></a>
(which I think will eventually be included in MozillaBuild, but it isn’t
currently). Again, just install it with the defaults.</p>
</div>
<div class="section" id="mozillabuild">
<h3><a class="toc-backref" href="#id6">MozillaBuild:</a></h3>
<p>Almost there, I promise. In order to get a *nix type shell to run
make, etc. in we’ll use a package from Mozilla that includes <span class="caps">MSYS</span>, make,
Mercurial, etc. Download and <a class="reference external" href="http://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe">install MozillaBuild</a>, the latest should
work fine.</p>
<p>Now, an unknown step: you might require the <a class="reference external" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&amp;displaylang=en">Microsoft Visual C++ 2008
<span class="caps">SP1</span> Redistributable Package</a>. I don’t know if you need this or not
since I <em>already</em> had it, most likely from a previous program I’ve installed.</p>
<p>We should be ready to build now pretty much. For some more
information for this stuff you can check out the Mozilla Developer
Network pages I used to get this information: <a class="reference external" href="https://developer.mozilla.org/En/Developer_Guide/Build_Instructions">Build Instructions</a>,
<a class="reference external" href="https://developer.mozilla.org/En/Developer_Guide/Build_Instructions/Windows_Prerequisites">Windows Build Prerequisites</a> and <a class="reference external" href="https://developer.mozilla.org/cn/VC8_Build_Instructions"><span class="caps">MSVC8</span> Build Instructions</a>.</p>
</div>
</div>
<div class="section" id="checkout-the-code">
<h2><a class="toc-backref" href="#id7">Checkout the Code:</a></h2>
<p>We need to checkout the code. I originally checked out the code with
TortoiseHg (which is what I normally use), but the version of Mercurial
included is significantly greater than the one included in MozillaBuild
and this caused me issues later on. Thus, we’ll check out the code on
the command line. Start by launching the bash shell, which is at
C:\mozilla-build\start-msvc8.bat (don’t use the x64 version). There’s
a version here which corresponds to each version of <span class="caps">VS</span>.</p>
<p>Once this finishes loading you’ll be in the home directory (which is
in the root of your user’s documents and settings folder, i.e. for me:
C:\Users\clokep). You’ll want to do the following:</p>
<div class="highlight"><pre><span></span>hg clone https://hg.instantbird.org/instantbird
</pre></div>
<p>This might take a few minutes depending on how good your internet
connection is. (The Instantbird source isn’t <span class="caps">THAT</span> big though, it
shouldn’t take too long.)</p>
<p>Then we’ll need to change into the instantbird directory that was just
created and download the Mozilla source code:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> instantbird
python client.py checkout
</pre></div>
<p>Now this step? This one is gonna take a while. It took me like a
couple of hours. It pulls the Mozilla source code, which is large and
has many changesets. Just let it go, it’ll give you progress
occasionally (changes, manifests, files, etc.)</p>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id8">Compiling Instantbird:</a></h2>
<p>We need to set up the options we want to build with. These are
read from a .mozconfig (don’t miss the “.” in the front!). The contents
of the .mozconfig that worked for me are:</p>
<div class="highlight"><pre><span></span>ac_add_options --enable-application<span class="o">=</span>instantbird
mk_add_options <span class="nv">MOZ_OBJDIR</span><span class="o">=</span>@TOPSRCDIR@/objdir-ib-release
ac_add_options --disable-accessibility
</pre></div>
<p>The first option says to build Instantbird, the second gives an output
directory and the third <a class="reference external" href="https://developer.mozilla.org/en/atlbase.h">disables accessibility</a> (not really sure why
we need to do this, but we’ll get that error at that link otherwise).</p>
<p>Finally (back in the bash shell) type:</p>
<div class="highlight"><pre><span></span>make -f client.mk build
</pre></div>
<p>Now sit back and relax. My build took about an hour to finish, maybe
a bit less — I wasn’t fully paying attention. Once it’s done you
should see something like:</p>
<div class="highlight"><pre><span></span>Processed <span class="m">1</span> file, writing output:

Output:
<span class="s2">"c:\\Users\\clokep\\instantbird\\objdir-ib-release\\instantbird\\installer\\windows\\instgen\\helper.exe"</span>
Install: <span class="m">2</span> pages <span class="o">(</span><span class="m">128</span> bytes<span class="o">)</span>, <span class="m">1</span> section <span class="o">(</span><span class="m">16416</span> bytes<span class="o">)</span>, <span class="m">2579</span>
instructions <span class="o">(</span><span class="m">72212</span> bytes<span class="o">)</span>, <span class="m">369</span> strings <span class="o">(</span><span class="m">10198</span> bytes<span class="o">)</span>, <span class="m">1</span> language table <span class="o">(</span><span class="m">230</span> bytes<span class="o">)</span>.
Uninstall: <span class="m">5</span> pages <span class="o">(</span><span class="m">320</span> bytes<span class="o">)</span>,
<span class="m">1</span> section <span class="o">(</span><span class="m">16416</span> bytes<span class="o">)</span>, <span class="m">2063</span> instructions <span class="o">(</span><span class="m">57764</span> bytes<span class="o">)</span>, <span class="m">388</span> strings
<span class="o">(</span><span class="m">10828</span> bytes<span class="o">)</span>, <span class="m">1</span> language table <span class="o">(</span><span class="m">314</span> bytes<span class="o">)</span>.
Datablock optimizer saved <span class="m">123940</span> bytes <span class="o">(</span>~17.6%<span class="o">)</span>.
Using zlib compression.
EXE header size:               <span class="m">63488</span> / <span class="m">39424</span> bytes
Install code:                  <span class="m">99564</span> / <span class="m">99560</span> bytes
Install data:                 <span class="m">118002</span> / <span class="m">241950</span> bytes
Uninstall code+data:          <span class="m">398654</span> / <span class="m">398646</span> bytes
CRC <span class="o">(</span>0x062AF3F5<span class="o">)</span>:                  <span class="m">4</span> / <span class="m">4</span> bytes
Total size:                   <span class="m">679712</span> / <span class="m">779584</span> bytes <span class="o">(</span><span class="m">87</span>.1%<span class="o">)</span>
c:/Users/clokep/instantbird/objdir-ib-release/mozilla/config/nsinstall.exe -D ../../../mozilla/dist/bin/uninstall
cp instgen/helper.exe ../../../mozilla/dist/bin/uninstall
make<span class="o">[</span><span class="m">5</span><span class="o">]</span>: Leaving directory <span class="sb">`</span>/c/Users/clokep/instantbird/objdir-ib-release/instantbird/installer/windows<span class="s1">'</span>
<span class="s1">make[4]: Leaving directory `/c/Users/clokep/instantbird/objdir-ib-release/instantbird'</span>
make<span class="o">[</span><span class="m">3</span><span class="o">]</span>: Leaving directory <span class="sb">`</span>/c/Users/clokep/instantbird/objdir-ib-release<span class="s1">'</span>
<span class="s1">make[2]: Leaving directory `/c/Users/clokep/instantbird/objdir-ib-release'</span>
make<span class="o">[</span><span class="m">1</span><span class="o">]</span>: Leaving directory <span class="sb">`</span>/c/Users/clokep/instantbird/objdir-ib-release<span class="err">'</span>
</pre></div>
<p>Now, to test that the build actually worked we can browse to the
compiled executable and run it:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> objdir-ib-release/mozilla/dist/bin/instantbird.exe -P dev -no-remote
</pre></div>
<p>The -P option specifies a profile name (dev), the second option
(-no-remote) allows you to run a second Instantbird instance (since I
assume you use Instantbird to <span class="caps">IM</span>…you probably want to be able to run a
second one, if you don’t use it…shame on you. Try not to close the
wrong Instantbird when you’re working on stuff).</p>
<p>Hopefully this will help someone else get started on hacking
Instantbird. There’s other good ways you can hack too if your computer
can’t handle compiling, including unpacking omni.jar.</p>
<p>One last tidbit is to possibly add the option to your .mozconfig:</p>
<div class="highlight"><pre><span></span>--enable-chrome-format<span class="o">=</span>flat
</pre></div>
<p>This will not package anything in JARs (which pretty much just get in
the way while developing). See <a class="reference external" href="https://developer.mozilla.org/en/JAR_Packaging">here</a> for more info.</p>
<p>Edit: Fixed the path to the executable thanks to Florian. And fixed a
spelling error in the title.</p>
</div>

      </div>

<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = '/posts/2011/05/16/compilling-instantbird/';
this.page.identifier = 'compilling-instantbird';
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://clokep.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>

    <nav class="navbar fixed-bottom navbar-light bg-light border-top border-info">
      <a href="https://getpelican.com/" class="nav-item" target="_blank">Powered by Pelican</a>
      <a href="https://github.com/clokep/clokep.github.io" class="nav-item" target="_blank">
        Source available on GitHub <span class="fab fa-github"></span>
      </a>
    </nav>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

  </body>
</html>